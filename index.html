<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Map Reservation System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0b1d3a;
  color: #e6ebff;
  overflow: hidden;
}

/* HEADER */
.header {
  height: 160px;
}
.header img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* TOP BAR */
.topbar {
  padding: 10px;
  background: #08162e;
  font-size: 18px;
  border-bottom: 1px solid #1c2f5a;
}

/* MAIN */
.container {
  display: flex;
  height: calc(100vh - 200px);
}

/* LEFT */
.left {
  width: 300px;
  background: #081b3a;
  overflow-y: auto;
}

.member {
  padding: 10px;
  border-bottom: 1px solid #142a52;
}

.member.active {
  background: #ffd43b;
  color: #000;
  font-weight: bold;
  animation: blink 1s infinite, glow 1.5s infinite;
}

.member.reserved {
  color: #9aa4c7;
  font-style: italic;
}

@keyframes blink {
  50% { background: #fff3bf; }
}

@keyframes glow {
  0% { box-shadow: 0 0 5px #ffd43b; }
  50% { box-shadow: 0 0 20px #ffd43b; }
  100% { box-shadow: 0 0 5px #ffd43b; }
}

/* MAP */
.map-area {
  flex: 1;
  overflow: auto;
  background: #000814;
  touch-action: none;
}

.map-wrapper {
  position: relative;
  transform-origin: top left;
}

.map-wrapper img {
  display: block;
  max-width: 100%;
  user-select: none;
}

/* DOT */
.dot {
  position: absolute;
  width: 44px;
  height: 44px;
  background: #ff2b2b;
  color: white;
  font-size: 20px;
  font-weight: bold;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 0 12px rgba(255,0,0,0.9);
  pointer-events: none;
}

/* CONTROLS */
.controls {
  position: fixed;
  right: 10px;
  bottom: 10px;
  z-index: 10;
}
.controls button {
  padding: 6px 12px;
  margin: 3px;
  background: #102a5c;
  color: #fff;
  border: 1px solid #294a8a;
  border-radius: 4px;
}
</style>
</head>

<body>

<div class="header">
  <img src="mythic_header.png">
</div>

<div class="topbar" id="statusBar">
  Current Queue: <span id="currentQueue">1</span> â€” Click a spot on the map
</div>

<div class="container">
  <div class="left" id="memberList"></div>

  <div class="map-area" id="mapArea">
    <div class="map-wrapper" id="mapWrapper">
      <img id="map" src="map.jpg">
      <div id="dots"></div>
    </div>
  </div>
</div>

<div class="controls">
  <button onclick="zoomIn()">+</button>
  <button onclick="zoomOut()">âˆ’</button>
  <button onclick="resetZoom()">Reset</button>
  <hr>
  <button onclick="adminUndo()">Undo</button>
  <button onclick="adminReset()">Reset</button>
</div>

<script>
const memberNames = [
"LGoHo","GinTonic","Cabernet","SLANE","TheDalmore","Wulinagye",
"AmericanoNoSweet","Asahi","GoldLabel","MadamREDRUM","21stHIBIKI",
"Highball","BlueLaBel","HalesBlueBoy","à¹€à¸ªà¸·à¸­à¸à¹‰à¸²à¸¢",
"CaramelMacchiato","17thHIBIKI"
];

let state = JSON.parse(localStorage.getItem("mapState")) || {
  queue: 1,
  booked: {},
  history: [],
  scale: 1
};

let { queue, booked, history, scale } = state;
let locked = false;

const memberList = document.getElementById("memberList");
const map = document.getElementById("map");
const mapWrapper = document.getElementById("mapWrapper");
const dots = document.getElementById("dots");
const statusBar = document.getElementById("statusBar");

/* MEMBERS */
const members = [];
memberNames.forEach((name,i)=>{
  const trophy = i===0?"ðŸ¥‡":i===1?"ðŸ¥ˆ":i===2?"ðŸ¥‰":"";
  const div=document.createElement("div");
  div.className="member";
  div.textContent=`${i+1}. ${trophy} ${name}`;
  memberList.appendChild(div);
  members.push(div);
});

/* RESTORE DOTS */
Object.keys(booked).forEach(k=>{
  const [x,y]=k.split("_").map(Number);
  drawDot(x,y,booked[k]);
});

/* HIGHLIGHT */
function updateHighlight(){
  members.forEach(m=>m.classList.remove("active"));
  if(members[queue-1]) members[queue-1].classList.add("active");
}
updateHighlight();

/* MAP CLICK */
mapWrapper.addEventListener("click",e=>{
  if(e.target!==map) return;
  const r=map.getBoundingClientRect();
  const x=Math.floor((e.clientX-r.left)/scale);
  const y=Math.floor((e.clientY-r.top)/scale);
  const key=`${x}_${y}`;
  if(booked[key]) return alert("Already reserved");
  if(!confirm("Confirm this selection?")) return;

  booked[key]=queue;
  history.push({key});
  drawDot(x,y,queue);

  members[queue-1].classList.add("reserved");
  members[queue-1].textContent+=" - Reserved";

  if(queue===memberNames.length){
    locked=true;
    statusBar.innerHTML="All queues completed â€” LOCKED";
  } else {
    queue++;
    document.getElementById("currentQueue").innerText=queue;
    updateHighlight();
  }
  save();
});

/* DOT */
function drawDot(x,y,n){
  const d=document.createElement("div");
  d.className="dot";
  d.textContent=n;
  d.style.left=(x-22)+"px";
  d.style.top=(y-22)+"px";
  dots.appendChild(d);
}

/* ZOOM */
function applyZoom(){mapWrapper.style.transform=`scale(${scale})`;save();}
function zoomIn(){scale=Math.min(3,scale+0.1);applyZoom();}
function zoomOut(){scale=Math.max(0.5,scale-0.1);applyZoom();}
function resetZoom(){scale=1;applyZoom();}
applyZoom();

/* SAVE */
function save(){
  localStorage.setItem("mapState",JSON.stringify({queue,booked,history,scale}));
}

/* ADMIN */
function adminUndo(){
  if(prompt("Password")!=="7890")return;
  const last=history.pop();
  if(!last)return;
  delete booked[last.key];
  dots.lastChild.remove();
  queue--;
  members[queue-1].classList.remove("reserved");
  members[queue-1].textContent=`${queue}. ${memberNames[queue-1]}`;
  locked=false;
  updateHighlight();
  save();
}

function adminReset(){
  if(prompt("Password")!=="7890")return;
  localStorage.removeItem("mapState");
  location.reload();
}
</script>

</body>
</html>
